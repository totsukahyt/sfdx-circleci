"use strict";angular.module("SB_NameCard_RegistCtrls",["SB_NameCard_RegistService"]).controller("TopCtrl",["$scope","$log","svr_config","$svrSettings","$sfdcFunction","$location",function(c,e,t,o,n,r){e.info("TopCtrl"),c.working=!0,c.caption="",c.overwrite="",c.explainCount="",c.showExp=!1,c.config=t,c.namespace_x=namespace_x,c.sfdcErr=null,c.working=!0,c.editMode=!1,c.cardId=targetId,c.uiType=uiType,c.retUrl=retUrl||"s1RecDetail",c.recTypeInfo={},c.card={},c.accounts=[],c.contacts=[],c.searchAIndex=-1,c.searchCIndex=-1,c.registParam={cardId:targetId,operation:-1,accountId:null,contactId:null},c.settings=o.get(),c.$watch("settings.overwriteAccount",function(e,t,n){o.set(c.settings)}),c.$watch("settings.overwriteContact",function(e,t,n){o.set(c.settings)}),c.$watch("settings.queryAccountWithDept",function(e,t,n){o.set(c.settings)}),c.$watch("settings.queryAccountWithState",function(e,t,n){o.set(c.settings)}),c.$watch("settings.queryAccountWithCity",function(e,t,n){o.set(c.settings)}),c.$watch("settings.queryAccountWithZip",function(e,t,n){o.set(c.settings)}),c.$watch("settings.queryAcntRecType",function(e,t,n){o.set(c.settings)}),c.$watch("settings.registRecType.account",function(e,t,n){o.set(c.settings)}),c.$watch("settings.queryContRecType",function(e,t,n){o.set(c.settings)}),c.$watch("settings.registRecType.contact",function(e,t,n){o.set(c.settings)}),c.changedSettings=function(){o.set(c.settings)},"/menu/regist/account"!==r.path()&&r.path("/menu/regist/account")}]).controller("MenuCtrl",["$scope","$log","$translate","$q","$filter","$sfdcFunction","$location","$rootScope",function(c,o,r,a,e,i,t,n){o.info("MenuCtrl"),c.working=!0;c.labels={};function s(){c.labels.caption=e("sprintfT")("T_DoSelect",[c.config.accountLabel]),c.labels.overwrite=e("sprintfT")("M_OverWrite",[c.config.accountLabel]),c.labels.explainCount=e("sprintfT")("T_ExpCount",[c.config.contactLabel]),c.labels.queryOver=e("sprintfT")("M_QueryOver",[c.config.accountLabel])}function l(t){c.working=!0;var n=a.defer();return i.getRecordTypeInfo(t,function(e){c.recTypeInfo[t]=e,0<c.recTypeInfo[t].length&&(c.settings.registRecType[t]=c.recTypeInfo[t][0].id),c.$apply(),n.resolve(e)},function(e){o.error(e),c.sfdcErr=e,c.working=!1,c.$apply(),n.reject(e)}),n.promise}c.slides=[];function u(e){c.working=!0;var n=a.defer();return i.getNameCard(e,function(e){var t;c.card=e,c.registParam.cardId=e.id,t=e,c.slides=[{image:"/servlet/servlet.FileDownload?file="+t.image_id,card:null,id:0},{image:"/servlet/servlet.FileDownload?file="+t.bk_image_id,card:null,id:1},{image:null,card:t,id:2}],c.$apply(),n.resolve()},function(e){o.error(e),c.sfdcErr=e,c.working=!1,c.$apply(),n.reject(e)}),n.promise}c.getAccountOptions=function(){var t=a.defer();return i.getAccountOptions(c.cardId,function(e){c.accounts=e,c.searchAIndex=e.length-(c.config.enableAccountCreate?2:1),c.showExp=c.accounts.some(function(e){if(0<e.contactCount)return!0}),c.working=!1,c.$apply(),t.resolve()},function(e){o.error(e),c.sfdcErr=e,c.working=!1,angular.isDefined(c.working2)&&(c.working2=!1),c.$apply(),t.reject(e)}),t.promise};var f=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};if(1==c.config.enableSfdc)(function(){c.working=!0;var n=a.defer();return i.getSVConfig(function(e){var t;f(c.config,e),t=c.config,c.settings.overwriteAccount=t.enableAccountEdit&&t.sOverwriteAccount,c.settings.overwriteContact=t.enableContactEdit&&t.sOverwriteContact,"ja"!==c.config.sUserLanguage&&r.use(c.config.sUserLanguage),s(),o.info(c.config),c.$apply(),n.resolve()},function(e){o.error(e),c.sfdcErr=e,c.working=!1,c.$apply(),n.reject(e)}),n.promise})().then(function(){return l("account")},function(){}).then(function(){return c.working=!0,l("contact")},function(){}).then(function(){return u(c.cardId)},function(){}).then(function(){return c.working=!0,c.getAccountOptions()});else{c.working=!1,c.config.sUserLocale="ja_JP",c.config.sSmartViscaServerOptions=[],c.config.accountLabel="アカウント",c.config.contactLabel="コンタクト",c.config.sOverwriteAccount=!0,c.config.sOverwriteContact=!0,copyConfig(c.config),o.info(c.config),s(),c.recTypeInfo.account=[{id:"01210000000kSY2AAM",label:"取引先レコードタイプ2"},{id:"01210000000RNGSAA4",label:"testRec"}],null===c.settings.registRecType.account&&(c.settings.registRecType.account=c.recTypeInfo.account[0].id),c.recTypeInfo.contact=[{id:"01210000000RNG8AAO",label:"Rec1"},{id:"01210000000RNGDAA4",label:"Rec2"}],null===c.settings.registRecType.contact&&(c.settings.registRecType.contact=c.recTypeInfo.contact[0].id);var g=i.getDummyData();c.card=g.card,c.accounts=g.accounts,c.slides=[{image:"https://c.ap0.visual.force.com/servlet/servlet.FileDownload?file=00P1000000IYjn8EAD",card:null,id:0},{image:"https://c.ap0.visual.force.com/servlet/servlet.FileDownload?file=00P1000000IYjnDEAT",card:null,id:1},{image:null,card:c.card,id:2}],c.working=!1}}]).controller("RegstCtrl",["$scope","$log","$location","$filter","$q","$state","$stateParams","$window","$svModal","$sfdcFunction","ngProgressFactory",function(n,t,e,c,o,r,a,i,s,l,u){t.info("RegstCtrl"),n.noWrapSlides=!1,n.active=0,n.working=!0,n.accountWord="",n.contactWord="",n.panel=0,n.panelH=null,n.selectedItem={account:null,contact:null},n.complete=!1;var f={step1:{no:1,id:"step1",ref:"account"},step2:{no:2,id:"step2",ref:"contact"},step3:{no:3,id:"step3",ref:"confirm"}};n.getStep=function(){return"menu.regist.account"===r.current.name?1:"menu.regist.contact"===r.current.name?2:"menu.regist.confirm"===r.current.name?3:-1},n.setComplete=function(e){n.complete=e},n.isEnableStep2=function(){return 3!==n.selectedItem.account.type||1<n.recTypeInfo.contact.length},n.skip=function(e){if(!n.complete){var t=f[e.target.id];r.current.name.endsWith(t.ref)||!n.isEnableStep2()&&2===t.no||(n.progressbar.set(34*t.no),r.go("menu.regist."+t.ref))}},n.setProgress=function(e){n.progressbar.set(34*e)},n.saveOtherAccount=function(e){e.type=1,e.selected=!0,n.accounts[n.searchAIndex].selected=!1,n.accounts.splice(n.searchAIndex,0,e),n.selectedItem.account=n.accounts[n.searchAIndex],n.searchAIndex++},n.saveSelectedAccount=function(e){(n.selectedItem.account=e).Id&&(n.registParam.accountId=e.Id),n.contacts=[]},n.saveOtherContact=function(e){e.type=1,e.selected=!0,n.contacts[n.searchCIndex].selected=!1,n.contacts.splice(n.searchCIndex,0,e),n.selectedItem.contact=n.contacts[n.searchCIndex],n.searchCIndex++},n.saveSelectedContact=function(e){(n.selectedItem.contact=e).Id&&(n.registParam.contactId=e.Id)},n.openDetail=function(e){n.item=e,s.openDetail(n,"viewDetail.html").then(function(){t.info("Modal closed")})};n.progressbar=u.createInstance(),n.progressbar.setParent(document.getElementById("progressbar")),0==n.config.enableSfdc&&n.progressbar.setAbsolute(),n.progressbar.setHeight("5px"),n.progressbar.setColor("#2e8b57"),n.progressbar.set(34);n.getContactOptions=function(){1==n.config.enableSfdc?(n.cardId,n.working=!0,l.getContactOptions(n.card.id,n.selectedItem.account.id,function(e){n.contacts=e,n.searchCIndex=e.length-(n.config.enableContactCreate?2:1),n.working=!1,n.$apply()},function(e){t.error(e),n.err=e,n.working=!1,n.$apply(),alert(c("translate")("M_SfdcError"))})):(n.contacts=l.getContactData(),n.working=!1)},n.getSeletedItem=function(e){if(null===e||0===e.length)return null;var t=null;return e.forEach(function(e){!0===e.selected&&(t=e)}),t},n.return=function(){void 0!==i.sforce&&null!=i.sforce?"s1RecDetail"!==n.retUrl?i.sforce.one.navigateToURL(n.retUrl):i.sforce.one.navigateToSObject(n.cardId,"detail"):i.open(n.retUrl,"_top")}}]).controller("AccountCtrl",["$scope","$log","$location","$filter","$q","$state","$window","$svModal","$sfdcFunction",function(t,e,n,c,o,r,a,i,s){e.info("AccountCtrl"),t.working2=!0,t.oneAtATime=!0;var l=t.getSeletedItem(t.accounts);t.refresh=function(e){t.working2=!0,t.getAccountOptions().then(function(){t.working2=!1})},t.openAccount=function(e){e.accountId&&(void 0!==a.sforce&&null!=a.sforce?a.sforce.one.navigateToURL("/"+e.accountId):a.open("/"+e.accountId,"_top"))},t.openSearchAccount=function(){r.go("menu.regist.searcha"),l.selected=!1},t.toggleSelect=function(e){null!==l&&l!=e&&(l.selected=!1),e.selected,e.selected,l=e.selected?e:null},t.isSelected=function(){return null!==l&&2!==l.type&&angular.isDefined(l.selected)&&l.selected},t.next=function(){null!==l&&2!==l.type&&(null!==t.selectedItem.account&&t.selectedItem.account!=l&&(t.selectedItem.contact=null,t.contacts.length=0),t.selectedItem.account=l,!1===t.isEnableStep2()?(t.setProgress(3),r.go("menu.regist.confirm")):(t.setProgress(2),r.go("menu.regist.contact")))},t.working2=!1}]).controller("SearchACtrl",["$scope","$log","$location","$filter","$q","$state","$svModal","$sfdcFunction",function(t,n,e,c,o,r,a,i){n.info("SearchACtrl"),t.labels={},t.labels.caption=c("sprintfT")("T_DoSearch",[t.config.accountLabel]),t.labels.notfound=c("sprintfT")("M_NotFound",[t.config.accountLabel]),t.done=!1,t.working=!0,t.recents=[],t.companies=[];t.search=function(){t.searchForm.$valid&&(1==t.config.enableSfdc?(t.working=!0,i.searchAccount(t.accountWord,function(e){t.companies=e,t.done=!0,t.working=!1,t.$apply()},function(e){n.error(e),t.err=e,t.done=!0,t.working=!1,t.$apply(),alert(c("translate")("M_SfdcError"))})):(t.companies=i.getDummyCompanies(),t.done=!0,t.working=!1))},t.select=function(e){t.saveOtherAccount(e),t.cancel()},t.cancel=function(){r.go("menu.regist.account")},t.working=!0,i.getRecentlyViewed("Account",function(e){t.recents=e,t.working=!1,t.$apply()},function(e){n.error(e),t.err=e,t.working=!1,t.$apply(),alert(c("translate")("M_SfdcError"))})}]).controller("ContactCtrl",["$scope","$log","$location","$filter","$q","$state","$svModal","$sfdcFunction",function(e,t,n,c,o,r,a,i){t.info("ContactCtrl"),e.oneAtATime=!0;var s=e.getSeletedItem(e.contacts);e.labels={},3!==e.selectedItem.account.type?e.labels.caption=c("sprintfT")("T_DoSelectAt",[e.selectedItem.account.title,e.config.contactLabel]):e.labels.caption=c("sprintfT")("T_DoSelect",[e.config.contactLabel]),e.labels.overwrite=c("sprintfT")("M_OverWrite",[e.config.contactLabel]),e.openContact=function(e){e.Id&&(void 0!==$window.sforce&&null!=$window.sforce?$window.sforce.one.navigateToURL("/"+e.Id):$window.open("/"+e.contactId,"_top"))},e.openSearchContact=function(){r.go("menu.regist.searchc"),s.selected=!1},e.toggleSelect=function(e){null!==s&&e!=s&&(s.selected=!1),e.selected,e.selected,s=e.selected?e:null},e.isSelected=function(){return null!==s&&2!==s.type&&angular.isDefined(s.selected)&&s.selected},e.next=function(){null!==s&&2!==s.type&&(e.selectedItem.contact=s,e.setProgress(3),r.go("menu.regist.confirm"))},e.back=function(){e.setProgress(1),r.go("menu.regist.account")},0===e.contacts.length&&e.getContactOptions()}]).controller("SearchCCtrl",["$scope","$log","$location","$filter","$q","$state","$svModal","$sfdcFunction",function(t,n,e,c,o,r,a,i){n.info("SearchCCtrl"),t.labels={},t.labels.caption=c("sprintfT")("T_DoSearchAt",[t.selectedItem.account.title,t.config.contactLabel]),t.labels.notfound=c("sprintfT")("M_NotFound",[t.config.contactLabel]),t.done=!1,t.working=!0,t.contactWord="",t.candidates=[],t.persons=[];t.search=function(){t.searchForm.$valid&&(1==t.config.enableSfdc?(t.working=!0,i.searchContact(t.contactWord,t.selectedItem.account.id,function(e){t.persons=e,t.done=!0,t.working=!1,t.$apply()},function(e){n.error(e),t.err=e,t.done=!0,t.working=!1,t.$apply(),alert(c("translate")("M_SfdcError"))})):(t.persons=i.getDummyPersons(),t.done=!0,t.working=!1))},t.select=function(e){t.saveOtherContact(e),t.cancel()},t.cancel=function(){r.go("menu.regist.contact")},t.working=!0,i.getAccountContacts(t.selectedItem.account.id,function(e){t.candidates=e,t.working=!1,t.$apply()},function(e){n.error(e),t.err=e,t.working=!1,t.$apply(),alert(c("translate")("M_SfdcError"))})}]).controller("ConfirmCtrl",["$scope","$log","$location","$filter","$q","$state","$window","$svModal","$sfdcFunction",function(c,t,e,n,o,r,a,i,s){t.info("ConfirmCtrl"),c.working=!0,c.registered=!1,c.success=!0,c.error="",c.duplication=null,c.labels={},c.labels.acntOW=n("sprintfT")("T_OverWrite",[c.config.accountLabel]),c.labels.acntNOW=n("sprintfT")("T_NoOverWrite",[c.config.accountLabel]),c.labels.acntCreate=n("sprintfT")("T_CreateNew",[c.config.accountLabel]),c.labels.contOW=n("sprintfT")("T_OverWrite",[c.config.contactLabel]),c.labels.contNOW=n("sprintfT")("T_NoOverWrite",[c.config.contactLabel]),c.labels.contCreate=n("sprintfT")("T_CreateNew",[c.config.contactLabel]),c.registParam.cardId=c.card.id,c.registParam.accountId=c.selectedItem.account.id||null,c.registParam.contactId=null!==c.selectedItem.contact&&c.selectedItem.contact.id||null,c.acntRecTypeName="",c.contRecTypeName="";function l(e,t){var n="";return angular.isDefined(c.recTypeInfo[e])&&c.recTypeInfo[e].forEach(function(e){e.id===t&&(n=e.label)}),n}angular.isDefined(c.recTypeInfo.account)&&1<c.recTypeInfo.account.length&&(c.acntRecTypeName=l("account",c.settings.registRecType.account)),angular.isDefined(c.recTypeInfo.contact)&&1<c.recTypeInfo.contact.length&&(c.contRecTypeName=l("contact",c.settings.registRecType.contact)),c.account=null,c.contact=null;function u(e,t,n){return null!==n&&(!(!angular.isDefined(t)||!t)||n.objName.toLowerCase()===e.toLowerCase()&&n.allowSave)}function f(){c.working=!0,c.registParam.accountAllowSave=u("Account",c.registParam.accountAllowSave,c.duplication),c.registParam.contactAllowSave=u("Contact",c.registParam.contactAllowSave,c.duplication),c.duplication=null,s.registAccountContact(c.registParam,function(e){t.info(e),c.success=e.success,e.success?(c.account=e.registeds[c.registParam.cardId].acnt,c.contact=e.registeds[c.registParam.cardId].cont,c.setComplete(!0)):e.dbErrors?(c.error=e.dbErrors[c.registParam.cardId].text,c.duplication=function(e){if(angular.isUndefined(e.dups))return null;var t={};return t.dups=e.dups,t.allowRetry=e.allowRetry,t.allowSave=!1,t}(e.dbErrors[c.registParam.cardId])):c.error=e.message,c.working=!1,c.registered=!0,c.$apply()},function(e){t.error(e),c.err=e,c.registered=!0,c.done=!0,c.working=!1,c.$apply(),alert(n("translate")("M_SfdcError"))})}c.back=function(){!1===c.isEnableStep2()?(c.setProgress(1),r.go("menu.regist.account")):(c.setProgress(2),r.go("menu.regist.contact"))},c.submit=function(){null!==c.duplication&&!1===c.duplication.allowSave||!0!==c.working&&f()},c.openRecord=function(e){var t=e.Id||e.id;void 0!==a.sforce&&null!=a.sforce?a.sforce.one.navigateToURL("/"+t):a.open("/"+t,"_top")},c.working=!1}]).controller("SettingsCtrl",["$scope","$log","$location","$stateParams","$filter","$svModal",function(e,t,n,c,o,r){t.info("SettingsCtrl"),e.labels={queryAbout:"",queryDept:"",queryState:"",queryCity:"",queryZip:"",queryAcntRecType:"",queryContRecType:""},e.labels.queryAbout=o("sprintfT")("T_AcoutQuery",[e.config.accountLabel,e.config.contactLabel]),e.labels.queryDept=o("sprintfT")("T_QueryDept",[e.config.accountLabel]),e.labels.queryState=o("sprintfT")("T_QueryState",[e.config.accountLabel]),e.labels.queryCity=o("sprintfT")("T_QueryCity",[e.config.accountLabel]),e.labels.queryZip=o("sprintfT")("T_QueryZip",[e.config.accountLabel]),e.labels.queryAcntRecType=o("sprintfT")("T_QueryRecType",[e.config.accountLabel]),e.labels.queryContRecType=o("sprintfT")("T_QueryRecType",[e.config.contactLabel])}]).controller("ListCtrl",["$scope","$log","$location","$filter","$q","$state","$svModal",function(e,t,n,c,o,r,a){t.info("ListCtrl")}]).controller("BulkCtrl",["$scope","$log","$location","$stateParams","$svModal",function(e,t,n,c,o){t.info("BulkCtrl")}]).controller("DetailCtrl",["$scope","$log","$location","$stateParams","$svModal",function(e,t,n,c,o){t.info("DetailCtrl")}]).controller("HistoryCtrl",["$scope","$log","$location","$stateParams","$svModal",function(e,t,n,c,o){t.info("DetailCtrl")}]).controller("TestCtrl",["$scope","$log","$location","$stateParams","$svModal",function(e,t,n,c,o){t.info("TestCtrl")}]);