<!-- /**
 *
 *  SB_NC_AccountBulkRegistDataTable
 *  取引先・取引先責任者一括登録のデータを表示するためのコンポーネント
 *
 *
 *  Copyright (C) 2019 SunBridge Inc. All Rights Reserved.
 *
 *  @author K.Yoshida
 *  @Version 2.2       2019.02.XX SV_DEV-1558 LEX 取引先登録 一括画面をLXパッケージ同様のLC化で追加
 *  @Version 2.4       2019.05.XX SV_DEV-1331 SLDS CSSクラス名変更対応
 *
 **/ -->
<aura:component implements="force:appHostable" access="global">
  <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
  <aura:attribute name="selectMap" type="Map" /> <!-- 名刺一覧のデータを保存されてます -->
  <aura:attribute name="fieldList" type="List" /> <!-- DataTableに表示する項目リスト -->
  <aura:attribute name="fieldList2" type="List" /> <!-- DataTableサイズリセット用 -->
  <aura:attribute name="fieldMap" type="Map" default="{}" /> <!-- DataTableのセルの幅設定Map -->
  <aura:attribute name="objs" type="List" /> <!-- DataTableに表示する内容 -->
  <aura:attribute name="mouseStart" type="string" /> <!-- ヘッダー位置調整の開始位置 -->
  <aura:attribute name="oldWidth" type="string" /> <!-- ヘッダー位置調整の開始Width -->
  <aura:attribute name="haveError" type="Boolean" default="false" /> <!-- エラーマック列表示するフラグ -->
  <aura:attribute name="labelMap" type="Map" /> <!-- 入力所の内容と表示保存されてます -->
  <aura:handler name="change" value="{!v.fieldList}" action="{!c.changeFieldList}" />
  <aura:handler event="aura:doneRendering" action="{!c.reSetThead }" />
  <aura:handler name="render" value="{!this}" action="{!c.reSetThead}" />
  <aura:attribute name="newWidth" type="string" />
  <aura:attribute name="currentEle" type="Object" />

  <!-- reSetWidth -->
  <aura:method name="reSetThead" action="{!c.reSetThead}" access="PUBLIC" />

  <div class="slds-table_header-fixed_container slds-scrollable_x" style="height: 100%;" onmouseup="{!c.resetColumn}">
    <!-- ヘッダー部分表示 -->
    <div class="slds-scrollable_y" style="max-height:350px;">
      <div>
        <table classs="dataTable" summary=""
          class="slds-table slds-table_header-fixed slds-table_bordered slds-table_edit slds-table_resizable-cols">
          <thead>
            <tr aura:id="dataTableTheadTr" class="slds-text-title_caps">
              <aura:renderIf isTrue="{!v.haveError == true}">
                <th />
              </aura:renderIf>
              <th style="position:static; " class="slds-text-title_caps" is="lightning-primitive-header-factory"
                scope="col" tabindex="-1" aria-label="Confidence">
                <span tabindex="-1" id="dataTableTheadSpancompany_name__c"
                  class="slds-has-button-menu slds-cell-fixed" onmousemove="{!c.setNewWidth}">

                  <div role="button" tabindex="-1" data-actionable="true"
                    class="slds-th__action slds-text-link_reset slds-is-sorted_asc">
                    <span title="{!v.labelMap.cardLabel_company_name__c}" class="slds-truncate">
                      {!v.labelMap.cardLabel_company_name__c}
                    </span>
                  </div>
                  <div is="lightning-primitive-resize-handler" tabindex="-1" data-actionable="true"
                    class="slds-resizable">
                    <input type="range" min="50" max="1000" class="slds-resizable__input slds-assistive-text"
                      id="cell-resize-handle-602" tabindex="0" />
                    <span class="slds-resizable__handle" onmousedown="{!c.calculateWidth}">
                      <span class="slds-resizable__divider"></span>
                    </span>
                  </div>
                </span>
              </th>

              <th style="position:static; " class="slds-text-title_caps" is="lightning-primitive-header-factory"
                scope="col" tabindex="-1" aria-label="Confidence">
                <span tabindex="-1" id="dataTableTheadSpandivision__c"
                  class="slds-has-button-menu slds-cell-fixed" onmousemove="{!c.setNewWidth}">

                  <div role="button" tabindex="-1" data-actionable="true"
                    class="slds-th__action slds-text-link_reset slds-is-sorted_asc">
                    <span title="{!v.labelMap.cardLabel_division__c}" class="slds-truncate">
                      {!v.labelMap.cardLabel_division__c}
                    </span>
                  </div>
                  <div is="lightning-primitive-resize-handler" tabindex="-1" data-actionable="true"
                    class="slds-resizable">
                    <input type="range" min="50" max="1000" class="slds-resizable__input slds-assistive-text"
                      id="cell-resize-handle-602" tabindex="0" />
                    <span class="slds-resizable__handle" onmousedown="{!c.calculateWidth}">
                      <span class="slds-resizable__divider"></span>
                    </span>
                  </div>
                </span>
              </th>


              <th style="position:static; " class="slds-text-title_caps" is="lightning-primitive-header-factory"
                scope="col" tabindex="-1" aria-label="Confidence">
                <span tabindex="-1" id="dataTableTheadSpantitle_name__c"
                  class="slds-has-button-menu slds-cell-fixed" onmousemove="{!c.setNewWidth}">

                  <div role="button" tabindex="-1" data-actionable="true"
                    class="slds-th__action slds-text-link_reset slds-is-sorted_asc">
                    <span title="{!v.labelMap.cardLabel_title_name__c}" class="slds-truncate">
                      {!v.labelMap.cardLabel_title_name__c}
                    </span>
                  </div>
                  <div is="lightning-primitive-resize-handler" tabindex="-1" data-actionable="true"
                    class="slds-resizable">
                    <input type="range" min="50" max="1000" class="slds-resizable__input slds-assistive-text"
                      id="cell-resize-handle-602" tabindex="0" />
                    <span class="slds-resizable__handle" onmousedown="{!c.calculateWidth}">
                      <span class="slds-resizable__divider"></span>
                    </span>
                  </div>
                </span>
              </th>

              <th style="position:static" is="lightning-primitive-header-factory" scope="col" tabindex="-1"
                aria-label="Confidence">
                <span tabindex="-1" id="dataTableTheadSpanName" class="slds-has-button-menu slds-cell-fixed"
                  onmousemove="{!c.setNewWidth}">

                  <div role="button" tabindex="-1" data-actionable="true"
                    class="slds-th__action slds-text-link_reset slds-is-sorted_asc">
                    <span title="{!v.labelMap.cardLabel_Name}" class="slds-truncate">
                      {!v.labelMap.cardLabel_Name}
                    </span>
                  </div>
                  <div is="lightning-primitive-resize-handler" tabindex="-1" data-actionable="true"
                    class="slds-resizable">
                    <input type="range" min="50" max="1000" class="slds-resizable__input slds-assistive-text"
                      id="cell-resize-handle-602" tabindex="0" />
                    <span class="slds-resizable__handle" onmousedown="{!c.calculateWidth}">
                      <span class="slds-resizable__divider"></span>
                    </span>
                  </div>
                </span>
              </th>

              <th style="position:static" class="slds-text-title_caps" is="lightning-primitive-header-factory"
                scope="col" tabindex="-1" aria-label="Confidence">
                <span tabindex="-1" id="dataTableTheadSpanAddress" class="slds-has-button-menu slds-cell-fixed"
                  onmousemove="{!c.setNewWidth}">

                  <div role="button" tabindex="-1" data-actionable="true"
                    class="slds-th__action slds-text-link_reset slds-is-sorted_asc">
                    <span title="{!v.labelMap.cardLabel_address__c}" class="slds-truncate">
                      {!v.labelMap.cardLabel_address__c}
                    </span>
                  </div>
                  <div is="lightning-primitive-resize-handler" tabindex="-1" data-actionable="true"
                    class="slds-resizable">
                    <input type="range" min="50" max="1000" class="slds-resizable__input slds-assistive-text"
                      id="cell-resize-handle-602" tabindex="0" />
                    <span class="slds-resizable__handle" onmousedown="{!c.calculateWidth}">
                      <span class="slds-resizable__divider"></span>
                    </span>
                  </div>
                </span>
              </th>

              <th style="position:static" class="slds-text-title_caps" is="lightning-primitive-header-factory"
                scope="col" tabindex="-1" aria-label="Confidence">
                <span tabindex="-1" id="dataTableTheadSpanmobile__c"
                  class="slds-has-button-menu slds-cell-fixed" onmousemove="{!c.setNewWidth}">

                  <div role="button" tabindex="-1" data-actionable="true"
                    class="slds-th__action slds-text-link_reset slds-is-sorted_asc">
                    <span title="{!v.labelMap.cardLabel_mobile__c}" class="slds-truncate">
                      {!v.labelMap.cardLabel_mobile__c}
                    </span>
                  </div>
                  <div is="lightning-primitive-resize-handler" tabindex="-1" data-actionable="true"
                    class="slds-resizable">
                    <input type="range" min="50" max="1000" class="slds-resizable__input slds-assistive-text"
                      id="cell-resize-handle-602" tabindex="0" />
                    <span class="slds-resizable__handle" onmousedown="{!c.calculateWidth}">
                      <span class="slds-resizable__divider"></span>
                    </span>
                  </div>
                </span>
              </th>

              <th style="position:static" class="slds-text-title_caps" is="lightning-primitive-header-factory"
                scope="col" tabindex="-1" aria-label="Confidence">
                <span tabindex="-1" id="dataTableTheadSpanemail__c"
                  class="slds-has-button-menu slds-cell-fixed" onmousemove="{!c.setNewWidth}">

                  <div role="button" tabindex="-1" data-actionable="true"
                    class="slds-th__action slds-text-link_reset slds-is-sorted_asc">
                    <span title="{!v.labelMap.cardLabel_email__c}" class="slds-truncate">
                      {!v.labelMap.cardLabel_email__c}
                    </span>
                  </div>
                  <div is="lightning-primitive-resize-handler" tabindex="-1" data-actionable="true"
                    class="slds-resizable">
                    <input type="range" min="50" max="1000" class="slds-resizable__input slds-assistive-text"
                      id="cell-resize-handle-602" tabindex="0" />
                    <span class="slds-resizable__handle" onmousedown="{!c.calculateWidth}">
                      <span class="slds-resizable__divider"></span>
                    </span>
                  </div>
                </span>
              </th>

              <aura:iteration var="va" items="{!v.fieldList}">
                <th style="position:static; " class="slds-text-title_caps" is="lightning-primitive-header-factory"
                  scope="col" tabindex="-1" aria-label="Confidence">
                  <span tabindex="-1" id="{!'dataTableTheadSpan' + va.fieldName}"
                    class="slds-has-button-menu slds-cell-fixed" onmousemove="{!c.setNewWidth}">

                    <div role="button" tabindex="-1" data-actionable="true"
                      class="slds-th__action slds-text-link_reset slds-is-sorted_asc">
                      <label class="slds-checkbox" for="{!va.fieldName}"
                        style="{!if(va.checkAll != true, 'display: none', '')}">
                        <input name="checkboxtop" type="checkbox" id="{!va.fieldName}" checked="{!va.checkAllCheck}"
                          onclick="{!c.selectAll}" />
                        <span class="slds-checkbox_faux checkboxleft"></span>
                        <span class="slds-assistive-text"></span>
                      </label>
                      &nbsp;
                      <span title="{!va.label}" class="slds-truncate">
                        {!va.label}
                      </span>
                    </div>
                    <div is="lightning-primitive-resize-handler" tabindex="-1" data-actionable="true"
                      class="slds-resizable">
                      <input type="range" min="100" max="1000" class="slds-resizable__input slds-assistive-text"
                        id="cell-resize-handle-602" tabindex="0" />
                      <span class="slds-resizable__handle" onmousedown="{!c.calculateWidth}">
                        <span class="slds-resizable__divider"></span>
                      </span>
                    </div>
                  </span>
                </th>
              </aura:iteration>
            </tr>
          </thead>
          <!-- 内容表示 -->
          <tbody>
            <aura:iteration var="obj" items="{!v.objs}" indexVar="indx">
              <tr style="width: 100%;" class="slds-hint-parent" is="lightning-primitive-datatable-row">
                <aura:renderIf isTrue="{!v.haveError == true}">
                  <td style="width: 30px;" role="gridcell">
                    <aura:renderIf isTrue="{!obj.haveError == true}">
                      <lightning:icon iconName="utility:error" size="small" alternativeText="Error!" variant="error" />
                    </aura:renderIf>
                  </td>
                </aura:renderIf>

                <td style="min-width: 100px;" role="gridcell">
                  <div
                    style="{!if(obj.cObjectMap.company_name__c != null, if(v.fieldMap.company_name__c.width != '', 'width:' + v.fieldMap.company_name__c.width + 'px', ''), 'display: none;')}"
                    class="slds-truncate">
                    {!obj.cObjectMap.company_name__c.label}
                  </div>
                </td>

                <td style="{!'min-width: 100px;'}" role="gridcell">
                  <div
                    style="{!if(obj.cObjectMap.division__c != null, if(v.fieldMap.division__c.width != '', 'width:' + v.fieldMap.division__c.width + 'px', ''), 'display: none;')}"
                    class="slds-truncate">
                    {!obj.cObjectMap.division__c.label}
                  </div>
                </td>
                <td style="{!'min-width: 100px;'}" role="gridcell">
                  <div
                    style="{!if(obj.cObjectMap.title_name__c != null, if(v.fieldMap.title_name__c.width != '', 'width:' + v.fieldMap.title_name__c.width + 'px', ''), 'display: none;')}"
                    class="slds-truncate">
                    {!obj.cObjectMap.title_name__c.label}
                  </div>
                </td>

                <td style="min-width: 100px" role="gridcell">
                  <div
                    style="{!if(obj.cObjectMap.Name != null, if(v.fieldMap.Name.width != '', 'width:' + v.fieldMap.Name.width + 'px', ''), 'display: none;')}"
                    class="slds-truncate">
                    <lightning:formattedUrl label="{!obj.cObjectMap.Name.label}" value="{!obj.cObjectMap.Name.link}" />
                  </div>
                </td>

                <td style="min-width: 100px" role="gridcell">
                  <div
                    style="{!if(obj.cObjectMap.Address != null, if(v.fieldMap.Address.width != '', 'width:' + v.fieldMap.Address.width + 'px', ''), 'display: none;')}"
                    class="slds-truncate">
                    {!obj.cObjectMap.Address.label}
                  </div>
                </td>

                <td style="min-width: 100px" role="gridcell">
                  <div
                    style="{!if(obj.cObjectMap.mobile__c != null, if(v.fieldMap.mobile__c.width != '', 'width:' + v.fieldMap.mobile__c.width + 'px', ''), 'display: none;')}"
                    class="slds-truncate">
                    {!obj.cObjectMap.mobile__c.label}
                  </div>
                </td>

                <td style="min-width: 100px" role="gridcell">
                  <div
                    style="{!if(obj.cObjectMap.email__c != null, if(v.fieldMap.email__c.width != '', 'width:' + v.fieldMap.email__c.width + 'px', ''), 'display: none;')}"
                    class="slds-truncate">
                    {!obj.cObjectMap.email__c.label}
                  </div>
                </td>

                <aura:iteration var="field" items="{!v.fieldList}">
                  <c:SB_NC_AccountBulkRegistDataTableCell index="{!indx}" width="{!field.width}"
                    aura:id="{!obj.id + field.fieldName}" eventName="{!field.eventName}" selectMap="{!obj.combobox}"
                    recordId="{!obj.id}" field="{!field}" cObjectMap="{!obj.cObjectMap}" />
                </aura:iteration>
              </tr>
            </aura:iteration>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</aura:component>